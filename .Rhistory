patrons <- read_csv("fakepatrons.csv")
grad_patrons <- inner_join(grads,patrons,by="ID")
grad_patrons %>% mutate(SIM=stringsim(LAST.x,LAST.y)) %>% filter(SIM>=1&SIM<0.5)
grad_patrons %>% mutate(SIM=stringsim(LAST.x,LAST.y)) %>% filter(SIM<=1&SIM>0.5)
grads
patrons
patrons <- patrons %>% mutate(LAST=toupper(LAST))
patrons <- patrons %>% mutate(FIRST=toupper(FIRST))
patrons
patrons %>% unite("NAMEKEY",LAST:FIRST,sep="",remove=FALSE)
patrons %>% filter(grepl("[[:punct:]]",LAST))
patrons %>% filter(grepl("[[:punct:]]",FIRST))
grads %>% filter(grepl("[[:punct:]]",FIRST))
grads %>% filter(grepl("[[:punct:]]",LAST))
patrons <- patrons %>% unite("NAMEKEY",LAST:FIRST,sep="",remove=FALSE)
grads <- grads %>% mutate(LAST=toupper(LAST))
grads <- grads %>% mutate(FIRST=toupper(FIRST))
grads
patrons
grads
grads %>% unite("NAMEKEY",LAST:FIRST,sep="",remove=FALSE)
grads <- grads %>% unite("NAMEKEY",LAST:FIRST,sep="",remove=FALSE)
grads
inner_join(grads,patrons,by="ID")
grad_patrons <- inner_join(grads,patrons,by="ID")
grad_patrons
grad_patrons %>% mutate(SIM=stringsim(NAMEKEY.x,NAMEKEY.y))
grad_patrons %>% mutate(SIM=stringsim(NAMEKEY.x,NAMEKEY.y)) %>% filter(SIM<=1&SIM>0.5)
library(fuzzyjoin)
stringdist_inner_join(grads,patrons,by="NAMEKEY",max_dist=3,method=c("lv"))
stringdist_inner_join(grads,patrons,by="NAMEKEY",max_dist=2,method=c("lv"))
ls()
rm(holds,parons_with_holds)
ls()
rm(patrons_with_holds)
patrons
patrons %>% mutate(CURRENT_CHECKOUTS = ifelse(CURRENT_CHECKOUTS=="0","4",CURRENT_CHECKOUTS))
patrons <- patrons %>% mutate(CURRENT_CHECKOUTS = ifelse(CURRENT_CHECKOUTS=="0","4",CURRENT_CHECKOUTS))
patrons
ls()
grad_patrons <- inner_join(grads,patrons,by="ID")
grad_patrons
stringdist()
stringdist("ca","abc")
stringdist("ABC","abc")
stringdist("ABC","ACB")
stringdist("ABC","ACAB")
stringdist(tolower("ABC"),"abc")
stringdist("MARTHA","MOTHRA")
stringdist("MOTHRA","MARTHA")
stringsim("ABC","ACAB")
stringsim("MARTHA","MOTHRA")
stringdist("ABOLISH ICE","ABOLISH THE POLICE")
stringsim("ABOLISH ICE","ABOLISH THE POLICE")
stringsim("ABOLISH ICE","ABOLISH POLICE")
stringsim("prison abolition","police abolition")
stringsim("R W Gilmore","Ruth Wilson Gilmore")
stringsim("the US prison system","justice")
ls()
grad_patrons
grad_patrons %>% mutate(SIMILARITY=stringsim(NAMEKEY.x,NAMEKEY.y))
grad_patrons <- grad_patrons %>% mutate(SIMILARITY=stringsim(NAMEKEY.x,NAMEKEY.y))
grad_patrons
grad_patrons %>% filter(SIMILARITY<1&SIMILARITY>0.8)
grad_patrons %>% filter(SIMILARITY<1&SIMILARITY>0.9)
grad_patrons
grad_patrons %>% filter(SIMILARITY<0.9)
grad_patrons <- rename(grad_patrons,ITEMS_OUT=CURRENT_CHECKOUTS)
grad_patrons
grad_patrons <- grad_patrons %>% select(ID:GRAD_DATE,NAMEKEY.y:GROUP,ITEMS_OUT,SIMILARITY)
grad_patrons
grad_patrons %>% filter(SIMILARITY<0.9)
grad_patrons %>% arrange(SIMILARITY)
grad_patrons %>% arrange(desc(SIMILARITY))
grad_patrons <- grad_patrons %>% arrange(desc(SIMILARITY))
grad_patrons
grad_patrons %>% filter(SIMILARITY<0.9)
savehistory()
q()
library(tidyverse)
ils <- read_csv("ils.csv")
kb <- read_csv("kb_package.csv")
kb
ls()
ils
ils
ils <- ils %>% select(mfhd_id,title,issn,holdings,location)
ils
ils %>% distinct(mfhd_id)
ils
rm(kb)
kb <- read_csv("kb.csv")
kb
ils
ils %>% mutate(title=gsub("[[:punct:]]","",title))
ils <- ils %>% mutate(title=gsub("[[:punct:]]","",title))
ils
ils %>% filter(grepl("[[:punct:]]",title))
ils %>% mutate(title=gsub("\\s+","",title))
ils %>% mutate(title=gsub("\\s+"," ",title))
ils <- ils %>% mutate(title=gsub("\\s+"," ",title))
ils
kb
kb %>% filter(grepl("[[:punct:]]",Title))
kb <- kb %>% mutate(Title=gsub("[[:punct:]]",Title))
kb <- kb %>% mutate(Title=gsub("[[:punct:]]","",Title))
kb
kb %>% filter(grepl("\\s+",Title))
kb %>% filter(grepl("\\s\\s",Title))
kb <- kb %>% mutate(Title=gsub("\\s+"," ",Title))
kb
ils
kb <- rename(kb,title=Title)
kb
kb_online <- kb %>% select(
title,Publisher,OnlineISSN) %>% filter(!is.na(OnlineISSN))
kb_online
kb
kb <- kb %>% select(title:PrintISSN)
kb
kb_online
kb
kb <- rename(kb,issn=PrintISSN)
kb_online <- rename(kb_online,issn=OnlineISSN)
rbind(kb,kb_online)
kb <- rbind(kb,kb_online)
kb
rm(kb_online)
l
ls()
ils
kb
ils <- ils %>% select(title,issn,location,mfhd_id)
ils
kb <- kb %>% select(title,issn,Publisher)
kb
ils
ils %>% mutate(title=tolower(title))
ils <- ils %>% mutate(title=tolower(title))
per
kb
kb <- kb %>% mutate(title=tolower(title))
kb
ils
inner_join(kb,ils,by="issn")
inner_join(kb,ils,by="issn",na.rm=TRUE)
inner_join(kb,ils,by="issn",na_matches="never")
kb
match_by_issn <- inner_join(kb,ils,by="issn",na_matches="never")
match_by_issn
anti_join(kb,match_by_issn,by="issn",na_matches="never")
anti_join(kb,match_by_issn,by="issn")
unmatched <- anti_join(kb,match_by_issn,by="issn")
unmatched
library(fuzzyjoin)
library(stringdist)
unmatched
kb <- kb_bu
kb
kb_bu <- kb
kb <- unmatched
ils
unmatched
ils <- ils %>%
arrange(title)
kb
kb <- kb %>% arrange(title)
kb
ils
ils %>% mutate(title=gsub("\\s+"," ",title))
str_trim(ils$title)
ils
ils %>% mutate(title=str_trim(title))
ils<-ils %>% mutate(title=str_trim(title))
ils
kb
stringdist_inner_join(kb,ils,by="title",max_dist=3,method=c("lv"))
stringdist_inner_join(kb,ils,by="title",max_dist=2,method=c("lv"))
title_match <- stringdist_inner_join(kb,ils,by="title",max_dist=3,method=c("lv"))
title_match %>% mutate(sim=
stringsim(title.x,title.y))
title_match <- title_match %>% mutate(sim=stringsim(title.x,title.y))
title_match
title_match %>% filter(sim<0.5)
stringdist_inner_join(kb,ils,by="title",max_dist=2,method=c("lv"))
title_match %>% filter(sim<0.5)%>%arrange(sim)
title_match %>% filter(sim<0.5)%>%arrange(desc(sim))
title_match %>% filter(sim<0.6)%>%arrange(desc(sim))
title_match %>% filter(sim<0.7)%>%arrange(desc(sim))
title_match %>% filter(sim<0.8)%>%arrange(desc(sim))
title_match <- stringdist_inner_join(kb,ils,by="title",max_dist=2,method=c("lv"))
title_match <- title_match %>% mutate(sim=stringsim(title.x,title.y))
title_match
title_match %>% arrange(sim)
title_match <- title_match %>% select(everything(),-Publisher))
title_match <- title_match %>% select(everything(),-Publisher)
title_match
title_match %>% arrange(sim)
kb
kb %>% filter(is.na(issn))
ls()
kb_bu
kb_bu %>% filter(is.na(issn))
kb_bu %>% filter(is.na(issn)) %>% distinct(title)
ls()
matched_by_issn
match_by_issn
match_by_issn %>% distinct(title.x)
kb_bu
kb_bu %>% distinct(title)
kb_bu
kb_bu %>% filter(!is.na(issn))
kb_bu %>% filter(!is.na(issn)) %>% distinct(title)
ls()
title_match
ils
kb
inner_join(kb,ils,by="title")
title_match %>% distinct(title)
title_match
title_match %>% distinct(title.x)
title_match
title_match %>% arrange(sim)
stringdist_inner_join(kb,ils,by="title",max_dist=2,methond
stringdist_inner_join(kb,ils,by="title",max_dist=2,method=c("lv"))
kb
kb <- kb %>% select(everything(),-Publisher)
stringdist_inner_join(kb,ils,by="title",max_dist=2,method=c("lv"))
title_match_demo <- stringdist_inner_join(kb,ils,by="title",max_dist=2,method=c("lv"))
title_match_demo
title_match_demo <- title_match_demo %>% select(title.x,title.y,issn.x,issn.y,mfhd_id)
title_match_demo
ls()
title_match
title_match <- title_match %>% select(title.x,title.y,issn.x,issn.y,sim)
title_match
title_match <- title_match %>% select(title.x,title.y,sim)
title_match
title_match %>% arrange(sim)
ls()
kb
title_match_dist <- stringdist_inner_join(kb,ils,by="title",max_dist=3,method=c("lv"))
title_match_dist
title_match_dist <- title_match_dist %>% mutate(sim=stringsim(title.x,title.y))
title_match_dist
title_match_dist %>% arrange(sim)
title_match_dist %>% filter(sim>0.9)
title_match_dist %>% filter(sim<1&sim>0.8)
title_match
title_match %>% filter(sim<1&sim>0.8)
title_match
title_match %>% filter(sim=1)
title_match %>% filter(sim<1)
title_match %>% filter(sim<1&sim>0.8)
title_match %>% filter(sim<1&sim>0.7)
title_match_dist
title_match_dist %>% filter(sim<0.5)
title_match_dist %>% filter(sim<0.3)
title_match_dist %>% filter(sim>0.6)
title_match_dist %>% filter(sim<1&sim>0.6)
title_match
title_match %>% filter(sim<1)
title_match %>% arrange(sim)
ls()
grad_patrons %>% filter(SIMILARITY<0.9)
savehistory()
q()
library(tidyverse)
library(fuzzyjoin)
library(stringdist)
ils <- read_csv("ils.csv")
kb <- read_csv("kb.csv")
ils
ils
ils <- ils %>% select(title,issn,holdings)
ils
kb <- read_csv("kb.csv")
ils <- read_csv("ils.csv")
ils <- ils %>% select(mfhd_id,title,issn,holdings)
ils
ils <- rename(ils,holdings_id=mfhd_id)
ils
kb
ils <- ils %>% select(holdings_id,title,issn)
ils
kb
kb <- kb %>% select(Title,PrintISSN,OnlineISSN)
kb
kb_online <- kb %>% select(Title,OnlineISSN) %>% filter(!is.na(OnlineISSN))
kb_online
kb
kb <- kb %>% select(Title,PrintISSN)
kb
kb %>% distinct(Title)
kb_online %>% distinct(Title)
kb_online
kb_online <- rename(kb_online,issn=OnlineISSN)
kb_online
kb <- rename(kb,issn=PrintISSN)
kb
kb_online
kb_online %>% distinct(Title)
kb_online %>% group_by(Title) %>% filter(n()>1)
kb_online %>% distinct()
kb_online %>% distinct() -> kb_online
kb
kb %>% distinct()
kb
kb_online
kb <- rbind(kb,kb_online)
kb
kb %>% distinct()
kb <- rename
kb
rename
ls()
kb
kb_bu
kb_bu %>% distinct()
kb_bu <- kb_bu %>% select(title,issn) 
kb_bu
kb_bu %>% distinct()
kb_bu %>% distinct() -> kb_bu
kb <- kb_bu
kb
ils
ils %>%
ils %>% filter(grepl("&",title))
kb 
kb %>% filter(grepl("&"))
kb %>% filter(grepl("&",title))
kb <- read_csv("kb.csv")
kb
kb <- kb %>% select(Title,PrintISSN,OnlineISSN)
kb
kb_online <- kb %>% select(Title,OnlineISSN) %>% filter(!is.na(OnlineISSN)) %>% distinct()
kb_online
kb_online <- rename(kb_online,issn=OnlineISSN)
kb_online
kb
kb <- kb %>% select(Title,PrintISSN)
kb <- rename(kb,issn=PrintISSN)
kb
online_issn
kb_online
kb_online %>% distinct()
kb %>% distinct()
kb <- rbind(kb,kb_online)
kb
kb %>% filter(grepl("&",Title))
kb
kb <- rename(kb,title=Title)
kb
ils
kb
kb %>%
write_csv(kb,"knowledge_base_package.csv")
ils
write_csv(ils,"print_holdings.csv")
ils
catalog <- ils
catalog
catalog %>% mutate(title=gsub("&","and",title))
catalog %>% filter(grepl("&",title))
catalog %>% mutate(title=gsub("&","and",title)) %>% filter(grepl("and",title))
catalog %>% mutate(title=gsub("&","and",title))
catalog %>% mutate(title=gsub("&","and",title)) <- catalog
catalog %>% mutate(title=gsub("&","and",title)) -> catalog
catalog
kb
kb %>% filter(grepl("&",title))
kb <- kb %>% mutate(title=gsub("&","and",title))
kb
kb %>% filter(grepl("&",title))
kb %>% filter(grepl("and",title))
kb
ils
catalog
catalog %>% filter(grepl("[[]]
catalog %>% filter(grepl("[[:punct:]]",title))
catalog %>% mutate(title=gsub("[[:punct:]]",title))
catalog %>% mutate(title=gsub("[[:punct:]]","",title))
catalog %>% mutate(title=gsub("[[:punct:]]","",title)) %>%
mutate(
catalog %>% mutate(title=gsub("[[:punct:]]","",title)) %>% mutate(title=gsub("\\s+"," ",title))
catalog %>% mutate(title=gsub("[[:punct:]]","",title)) %>% mutate(title=gsub("\\s+"," ",title)) -> catalog
catalog
kb
kb %>% 
mutate(
title=gsub("[[:punct:]]","",title)) %>%
mutate(title=gsub("\\+s"," ",title))
kb
kb %>% filter(grepl("\\s\\s",title))
kb %>% filter(grepl("[[:punct:]]",title))
kb %>% mutate(title=gsub("[[:punct:]]",title))
kb %>% mutate(title=gsub("[[:punct:]]","",title))
kb %>% mutate(title=gsub("[[:punct:]]","",title)) ->
kb
kb
kb %>% filter(grepl("\\s\\s",title))
kb %>% mutate(title=gsub("\\s+"," ",title))
kb %>% mutate(title=gsub("\\s+"," ",title)) %>% filter(grepl("\\s\\s",title))
kb %>% mutate(title=gsub("\\s+"," ",title)) -> kb
kb
catalog
catalog %>% mutate(title=tolower(title))
inner_join(kb,catalog,by=
"issn")
catalog
anti_join(kb,catalog,by="issn")
inner_join(kb,catalog,by="issn") -> issn_match
issn_match
inner_join(kb,catalog,by="issn",na_matches="never") -> issn_match
issn_match
anti_join(issn_match,kb,by="issn")
anti_join(kb,issn_match,by="issn")
anti_join(kb,catalog,by="issn")
kb
anti_join(kb,catalog,by="issn",na_matches="never")
kb_nomatch
ls()
kb_nomatch <- anti_join(kb,issn_match,by="issn")
kb_nomatch
stringdist_inner_join(kb_nomatch,catalog,by="title")
stringdist_inner_join(kb_nomatch,catalog,by="title",max_dist=2,method=c("lv"))
kb_nomatch
kb <- kb %>% mutate(title=tolower(title))
kb
kb_needmatch <- anti_join(kb,issn_match,by="issn")
kb_needmatch
stringdist_inner_join(kb_needmatch,catalog,by="title")
catalog
catalog <- catalog %>% mutate(title=tolower(title))
catalog
stringdist_inner_join(kb_needmatch,catalog,by="title")
stringdist_inner_join(kb_needmatch,catalog,by="title",max_dist=2,method=c("lv"))
stringdist_inner_join(kb_needmatch,catalog,by="title",max_dist=2,method=c("lv")) -> title_match
anti_join(kb_needmatch,title_match,by=c("title"="title.x"))
anti_join(kb_needmatch,title_match,by=c("title"="title.x")) -> kb_needmatch
title_match
title_match %>% select(title.x,title.y,issn.x,issn.y) -> title_match
title_match
title_match %>% mutate(similarity=stringsim(title.x,title.y))
title_match %>% mutate(similarity=stringsim(title.x,title.y)) %>% arrange(similarity)
title_match %>% filter(similarity<0.9)
title_match %>% mutate(similarity=stringsim(title.x,title.y)) %>% arrange(similarity) -> title_match
title_match %>% filter(similarity<0.9)
title_match
title_match %>% mutate(title.y=str_trim(title.y))
title_match
ls()
kb
hlm <- read_csv("kb.csv")
hlm
ils
hlm
hlm <- hlm %>% select(everything(),-Publisher)
hlm
hlm_online <- hlm %>% select(Title,OnlineISSN) %>% filter(!is.na(OnlineISSN) 
hlm_online <- hlm %>% select(Title,OnlineISSN) %>% filter(!is.na(OnlineISSN))
hlm_online <- renam
hlm_online
hlm_online <- rename(hlm_online,issn=OnlineISSN)
hlm
hlm <- hlm %>% select(Title,PrintISSN)
hlm <- rename(hlm_online,issn=PrintISSN)
hlm
hlm <- rename(hlm,issn=PrintISSN)
hlm
hlm_online
hlm <- rbin
hlm <- rbind(hlm,hlm_online)
hlm
hlm %>% distinct()
hlm<-hlm %>% distinct()
hlm
ils
stringdist_inner_join(hlm,ils,by="title",max_dist=2,methond=c("lv"))
hlm
hlm <- rename(hlm,title=Title)
stringdist_inner_join(hlm,ils,by="title",max_dist=2,methond=c("lv"))
stringdist_inner_join(hlm,ils,by="title",max_dist=2,method=c("lv"))
raw_match <- stringdist_inner_join(hlm,ils,by="title",max_dist=2,method=c("lv"))
raw_match
raw_match %>% mutate(sim=stringsim(title.x,title.y))
raw_match %>% mutate(sim=stringsim(title.x,title.y)) %>% arrange(desc(sim))
raw_match %>% mutate(sim=stringsim(title.x,title.y)) %>% arrange(sim)
raw_match <- stringdist_inner_join(hlm,ils,by="title",max_dist=3,method=c("lv"))
raw_match %>% mutate(sim=stringsim(title.x,title.y)) %>% arrange(sim)
raw_match <- stringdist_inner_join(hlm,ils,by="title",max_dist=2,method=c("lv"))
raw_match %>% mutate(sim=stringsim(title.x,title.y)) %>% arrange(sim)
title_mTch
title_match
title_match %>% arrange(desc(title.x))
hlm
ils
anti_join(hlm,ils,by="issn")
anti_join(hlm,ils,by="issn",na_matches="never")
anti_join(hlm,ils,by="issn",na_matches="never") -> hlm
stringdist_inner_join(hlm,ils,by="title",max_dist=2,method=c("lv"))
stringdist_inner_join(hlm,ils,by="title",max_dist=3,method=c("lv"))
raw_match <- stringdist_inner_join(hlm,ils,by="title",max_dist=3,method=c("lv"))
raw_match
raw_match %>% mutate(sim=stringsim(title.x,title.y)) %>% arrange(sim)
title_match
title_match %>% arrange(similarity)
options(tibble.print_min=25)
title_match %>% arrange(similarity)
title_match
title_match %>% arrange(title.x)
q()
